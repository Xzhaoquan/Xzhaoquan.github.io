---
title: modbus详解
date: 2025-03-23 14:54:36
tags: MODBUS
---

## **Modbus RTU 常用功能码详解（发送 & 接收）**

Modbus RTU 采用主从架构（Master-Slave），主机（Master）发送请求，从机（Slave）响应数据。数据通过串口（RS-485/RS-232）以 **二进制格式** 传输，并采用 **CRC16** 校验。

------

## **1. Modbus RTU 通信格式**

一个标准的 Modbus RTU 数据帧结构如下：

| 字节     | 内容                        | 说明                          |
| -------- | --------------------------- | ----------------------------- |
| 1        | **从机地址（Slave ID）**    | 1~247（0 号用于广播）         |
| 2        | **功能码（Function Code）** | 指定操作（读/写寄存器等）     |
| 3~x      | **数据字段（Data Field）**  | 读/写的地址、数量、数据等     |
| x+1, x+2 | **CRC 校验（CRC Check）**   | 16 位 CRC-16 校验，低字节在前 |

------

## **2. 常用功能码**

### **📌 功能码 0x01 - 读线圈状态（Read Coils）**

> 读取多个 **开关量输出（DO）** 的状态，每个线圈 1bit。

#### **📤 发送请求**

```
复制编辑从机地址  功能码  起始地址  线圈数量  CRC校验
01       01    00 13    00 0A    0CD1
```

- `01` —— 从机地址 1
- `01` —— 功能码 0x01（读取线圈状态）
- `00 13` —— 起始地址 0x0013（第 19 号线圈）
- `00 0A` —— 读取 10 个线圈状态
- `0C D1` —— CRC 校验（低字节在前）

#### **📥 响应数据**

```
复制编辑从机地址  功能码  字节数  数据   CRC校验
01       01    02    CD  6B   A1E3
```

- `02` —— 返回字节数 2（10 位线圈状态，按 8 位对齐）
- `CD`（11001101）—— 低 8 位（线圈 19-26）
- `6B`（01101011）—— 高 8 位（线圈 27-28，其余填 0）
- `A1 E3` —— CRC 校验

------

### **📌 功能码 0x03 - 读保持寄存器（Read Holding Registers）**

> 读取多个 **保持寄存器（AO）**，每个寄存器 16bit。

#### **📤 发送请求**

```
复制编辑从机地址  功能码  起始地址  寄存器数量  CRC校验
01       03    00 10    00 02    C5 CD
```

- `01` —— 从机地址 1
- `03` —— 读取保持寄存器
- `00 10` —— 起始地址 0x0010（第 16 号寄存器）
- `00 02` —— 读取 2 个寄存器
- `C5 CD` —— CRC 校验

#### **📥 响应数据**

```
复制编辑从机地址  功能码  字节数  数据1  数据2  CRC校验
01       03    04    00 64  27 10   72 30
```

- `04` —— 返回字节数 4（2 个寄存器，每个 2 字节）
- `00 64`（十进制 100）—— 第 16 号寄存器数据
- `27 10`（十进制 10000）—— 第 17 号寄存器数据
- `72 30` —— CRC 校验

------

### **📌 功能码 0x06 - 写单个保持寄存器（Write Single Register）**

> 设置 **一个** 保持寄存器的值。

#### **📤 发送请求**

```
复制编辑从机地址  功能码  寄存器地址  数据值   CRC校验
01       06    00 20    00 64    09 E9
```

- `01` —— 从机地址 1
- `06` —— 写单个寄存器
- `00 20` —— 寄存器地址 0x0020（第 32 号寄存器）
- `00 64`（十进制 100）—— 要写入的数据
- `09 E9` —— CRC 校验

#### **📥 响应数据**

```
复制编辑从机地址  功能码  寄存器地址  数据值   CRC校验
01       06    00 20    00 64    09 E9
```

> **响应数据与请求相同，表示写入成功**

------

### **📌 功能码 0x0F - 写多个线圈（Write Multiple Coils）**

> 设置 **多个** 开关量输出（DO）。

#### **📤 发送请求**

```
r复制编辑从机地址  功能码  起始地址  线圈数量  字节数  数据   CRC校验
01       0F    00 13    00 0A    02    CD  01   5B  99
```

- `0F` —— 写多个线圈
- `00 13` —— 起始地址 0x0013（第 19 号线圈）
- `00 0A` —— 写入 10 个线圈
- `02` —— 数据字节数（10bit 需 2 字节存储）
- `CD 01` —— 线圈数据（11001101 00000001）
- `5B 99` —— CRC 校验

#### **📥 响应数据**

```
r复制编辑从机地址  功能码  起始地址  线圈数量  CRC校验
01       0F    00 13    00 0A    C4 4E
```

> **表示从机确认已写入数据**

------

### **📌 功能码 0x10 - 写多个保持寄存器（Write Multiple Registers）**

> 写入 **多个** 寄存器（AO）。

#### **📤 发送请求**

```
复制编辑从机地址  功能码  起始地址  寄存器数量  字节数  数据       CRC校验
01       10    00 10    00 02    04    00 64  27 10   48 08
```

- `10` —— 写多个寄存器
- `00 10` —— 起始地址 0x0010（第 16 号寄存器）
- `00 02` —— 写入 2 个寄存器
- `04` —— 数据字节数 4
- `00 64 27 10` —— 数据（100、10000）
- `48 08` —— CRC 校验

#### **📥 响应数据**

```
复制编辑从机地址  功能码  起始地址  寄存器数量  CRC校验
01       10    00 10    00 02    71 CB
```

> **从机确认写入成功**

------

## **3. Modbus RTU 数据帧解析**

Modbus RTU 采用 **小端格式（Little Endian）**：

- **CRC 校验** 低字节在前
- **多字节数据** 高字节在前（Big Endian）

**解析 Modbus 数据包的关键：**

- 解析从机地址，判断是否匹配
- 解析功能码，决定操作类型
- 解析数据区，提取地址、值等信息
- 计算 CRC 校验，判断数据是否正确

------

## **4. 总结**

| 功能码 | 作用               | 典型用途     |
| ------ | ------------------ | ------------ |
| 0x01   | 读线圈（DO）       | 读取开关状态 |
| 0x03   | 读保持寄存器（AO） | 读取设备参数 |
| 0x06   | 写单个寄存器       | 修改设备设置 |
| 0x0F   | 写多个线圈         | 批量开关控制 |
| 0x10   | 写多个寄存器       | 批量参数修改 |